#  hackaton_sber_auto

Проект решения для хакатона от **СберАвтоподписка** от команды TEAM-A:
*Бортяков Алексей Юрьевич
*Горозий Максим Юрьевич
*Козырев Дмитрий Анатольевич
*Решетило Никита Сергеевич

**Цель:** Увеличение эффективности сайта за счёт предсказания вероятности целевого действия (оставить заявку, заказать звонок и пр.).

Модель позволяет:

-  Оценивать эффективность каналов привлечения трафика;
-  Адаптировать рекламные кампании;
-  Улучшать UX сайта на основе анализа пользовательского поведения.

---

##  Состав репозитория

- `EDA_data/` — разведывательный анализ данных
- `ga_hits_valid.pkl` — симуляционный датасет (hit-level)
- `ga_sessions_valid.pkl` — симуляционный датасет (session-level)
- `hac v3.ipynb` — черновая версия ноутбука
- `hac_v5.ipynb` — финальная версия ноутбука с моделью
- `app/model.pkl` — сериализованная модель
- `готовая презентация_хакатон_команда_TEAM-A.pptx` — итоговая презентация
- `текст для презентации 2.docx` — материалы для выступления
- API: [https://sberauto.cloud2.mgorozii.com/#/default/infer_infer_post](https://sberauto.cloud2.mgorozii.com/#/default/infer_infer_post)

---

##  Предобработка данных

### 1. Обработка пропусков

- Логика на основе `groupby + transform()`:
  - `hit_page_path → hit_referer`
  - `utm_medium + device_category → utm_source`
  - `utm_medium + device_os → utm_campaign`

### 2. Работа с датой

- Извлечены признаки:
  - `weekday`, `day`, `month`
- **Дата как timestamp не использовалась**, чтобы избежать ложных зависимостей.

### 3. Категориальные признаки

- `pd.factorize()` / `.astype('category').cat.codes`
- Снижение кардинальности (>50 уникальных значений):
  - Топ-49 категорий → остальное в `OTHER`
- `OrdinalEncoder` с `handle_unknown = -1`
- замена хэш-данных ненесущих смысловой нагрузки заменены на числовые идентификаторына

### 4. Числовые признаки

- Заполнение медианой
- Масштабирование: `StandardScaler`
- Дискретизация: квантильное биннингование (10 бинов)

### 5. Агрегация

- Агрегация хитов в сессии (1 строка = 1 сессия)

---

##  Анализ пользовательского поведения

### Сессии и хиты

- Длительность, число хитов, входные страницы
- Выделение категорий действий по типу событий

### События

- Частотный и структурный анализ событий
- Основные категории: просмотры, клики, формы

### Источники трафика

- `hit_referer`, `utm_source`, `utm_medium`, `utm_campaign` и др.

- Паттерны входа 

podpiska.sberauto.com/         49.7%
sberauto.com/cars?city=1...    18.4%

---

##  Используемая модель: **LightGBM**

Параметры:

```python
{
  'random_state': 42,
  'n_estimators': 150,
  'learning_rate': 0.2,
  'max_depth': 9,
  'num_leaves': 31,
  'subsample': 0.8,
  'colsample_bytree': 0.8,
  'reg_alpha': 0.1,
  'reg_lambda': 0.1,
  'n_jobs': -1,
  'verbose': -1
}
```

-  **Целевая переменная:** `main_action_grouped`

Типы событий:
Просмотры (sub_page_view: 39%)
Карточки авто (card_web: 33%)
Поиск (search_form: 9%) 

---

##  Результаты моделирования

- **Модель:** LightGBM
- **ROC-AUC:** `0.9277`
- **Accuracy:** `71.6%` (мультиклассовая, 18 классов)
- **Производительность:** `1.7M` записей за ~15 минут

---

##  Ключевые инсайты

- **41%** действий: просмотр лендингов (`sub_landing`)
- **22%**: карточки автомобилей (`view_card`)
- Сильная зависимость поведения от **устройств** и **геолокации**

---

##  Технологии и архитектура

### Оптимизация

- Уменьшение объёма памяти: **1.3 GB → 443 MB**
- Обработка категориальных фич без явного кодирования

### Архитектура

- Комбинированный пайплайн

Pipeline([
    # 1. Предобработка
    ColumnTransformer([
        ('numeric', numeric_pipeline, numeric_features),
        ('categorical', categorical_pipeline, categorical_features)
    ]),
    
    # 2. Модель
    HistGradientBoostingClassifier(
        random_state=42
    )
])

- Балансировка классов (class_weight='balanced')
- Мультиклассовая классификация

### Масштабируемость

- Поддержка > **2 млн записей**
- Готово к **production-интеграции**

---

##  Рекомендации для бизнеса

- **Приоритет 1:** Улучшение **мобильного UX** (79% трафика)
- **Приоритет 2:** Оптимизация подписной страницы (50% входов)

### Дополнительно:

- Мониторинг **аномальных сессий** (>100 хитов)
- Анализ эффективности **поисковых форм** (9% событий)

---

##  Итог

Проект успешно решает задачу **предсказания пользовательских действий**.  
Предложено готовое, масштабируемое решение с высокой точностью и бизнес-ценностью.

---

##  Установка

```bash
git clone https://github.com/CrimsonFox-hub/hackaton_sber_auto.git
cd hackaton_sber_auto
poetry install
poetry run pre-commit install
```

---

##  Загрузка модели

```python
import pickle

with open('app/model.pkl', 'rb') as f:
    model = pickle.load(f)
```

---

##  Предсказание

```python
prediction = model.predict(features)
print(prediction)
```

---

##  API

Пример запроса:

```bash
curl -X POST https://sberauto.cloud2.mgorozii.com/api/infer_infer_post -H "Content-Type: application/json" -d '{"data": [your_input_data_here]}'
```

---

##  Развертывание проекта

- Модель: `app/model.pkl`
- Финальный ноутбук: `hac_v5.ipynb`
- Аналитика: `EDA_data/`

---

##  Лицензия

Проект распространяется под лицензией [MIT License](https://opensource.org/licenses/MIT)  
Свободное использование, копирование и модификация при указании авторства.

---
